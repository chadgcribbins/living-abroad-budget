"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6760],{86760:function(e,t,r){r.d(t,{o:function(){return eS}});var a,o,n,s,c,i,l,u,d=r(59625),E=r(89134),g=r(85270),m=r(93837);let S={household:null,isComplete:!1,activeCountry:null,isHydrated:!1};var p=(e,t)=>{try{let e=t().profile;console.error("[profileSlice.ts CREATE_SLICE] isComplete from get().profile.isComplete:",null==e?void 0:e.isComplete,"isHydrated:",null==e?void 0:e.isHydrated)}catch(e){console.error("[profileSlice.ts CREATE_SLICE] Error accessing get().profile during initial create:",e)}return{...S,setHousehold:r=>{console.error("[profileSlice.ts] ***** setHousehold CALLED with:",r),e(e=>({...e,profile:{...e.profile,household:r,isComplete:!!r&&r.members.length>0,activeCountry:e.profile.activeCountry}})),console.log("[profileSlice.ts] setHousehold - new isComplete:",t().profile.isComplete)},updateHousehold:r=>{console.error("[profileSlice.ts] ***** updateHousehold CALLED with updates:",r),e(e=>{let t=e.profile.household?{...e.profile.household,...r}:r;return{...e,profile:{...e.profile,household:t,isComplete:!!t&&!!t.members&&t.members.length>0,activeCountry:e.profile.activeCountry}}}),console.log("[profileSlice.ts] updateHousehold - new isComplete:",t().profile.isComplete)},updateHouseholdMembers:r=>{console.error("[profileSlice.ts] ***** updateHouseholdMembers CALLED with members:",r),e(e=>{let t;let a=r.map(e=>{let t=["",""];"string"==typeof e.firstName?t=[e.firstName,e.lastName||""]:e.hasOwnProperty("name")&&"string"==typeof e.name&&(t=(e.name||"").split(" "));let r=t[0]||"",a=t.slice(1).join(" ")||"";return{id:e.id||(0,m.Z)(),firstName:r,lastName:a,dateOfBirth:e.dateOfBirth||new Date,relationship:e.relationship||g.S9.OTHER,isDependent:e.relationship===g.S9.CHILD}}),o=e.profile.household;return t=o?{...o,members:a,size:a.length,dependents:a.filter(e=>e.isDependent).length,updatedAt:new Date}:{id:(0,m.Z)(),members:a,originCountry:"",destinationCountry:"",residencyStatus:"",taxRegime:"",size:a.length,dependents:a.filter(e=>e.isDependent).length,createdAt:new Date,updatedAt:new Date},{...e,profile:{...e.profile,household:t,isComplete:t.members.length>0,activeCountry:e.profile.activeCountry}}}),console.log("[profileSlice.ts] updateHouseholdMembers - new isComplete:",t().profile.isComplete)},clearHousehold:()=>{console.error("[profileSlice.ts] ***** clearHousehold CALLED"),e(e=>({...e,profile:{...e.profile,household:null,isComplete:!1,activeCountry:null}}))},setActiveCountry:t=>e(e=>({...e,profile:{...e.profile,activeCountry:t}})),setHydrated:()=>{console.log("[profileSlice.ts] setHydrated called. Setting isHydrated to true."),e(e=>({...e,profile:{...e.profile,isHydrated:!0}})),console.log("[profileSlice.ts] isHydrated is now:",t().profile.isHydrated)}}},f=r(7310),A=r.n(f),y=r(97354);let N="scenarios",R=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:N;return"".concat("lab",":").concat(t,":").concat(e)},T=()=>{try{let e="".concat("lab",":test");localStorage.setItem(e,"test");let t=localStorage.getItem(e);return localStorage.removeItem(e),"test"===t}catch(e){return!1}},I=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:N;if(!T())return{success:!1,error:"LocalStorage is not available in this environment"};try{let r=localStorage.getItem(R(e,t));if(!r)return{success:!1,error:"No data found for key: ".concat(e)};let a=JSON.parse(r);return{success:!0,data:a}}catch(t){return{success:!1,error:"Error retrieving data for key ".concat(e,": ").concat(t instanceof Error?t.message:String(t))}}},h=e=>2*JSON.stringify(e).length,L=()=>{if(!T())return{success:!1,error:"LocalStorage is not available in this environment"};try{let e=0;for(let t=0;t<localStorage.length;t++){let r=localStorage.key(t);if(r){let t=localStorage.getItem(r);t&&(e+=2*r.length+2*t.length)}}return{success:!0,data:{used:e,available:5242880-e,total:5242880,usagePercentage:e/5242880*100}}}catch(e){return{success:!1,error:"Error calculating storage stats: ".concat(e instanceof Error?e.message:String(e))}}},C=e=>{if(!T())return{success:!1,error:"LocalStorage is not available in this environment"};try{let t=h(e),r=L();if(!r.success||!r.data)return{success:!1,error:r.error||"Failed to get storage stats"};let{available:a}=r.data;if(t>a)return{success:!1,error:"Not enough storage space. Needed: ".concat(t," bytes, Available: ").concat(a," bytes")};return{success:!0}}catch(e){return{success:!1,error:"Error checking storage space: ".concat(e instanceof Error?e.message:String(e))}}},D=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:N;if(!T())return{success:!1,error:"LocalStorage is not available in this environment"};try{let a=R(e,r),o=localStorage.getItem(a);if(o){let e=2*o.length,r=h(t);if(r>e){let t=L();if(!t.success||!t.data)return{success:!1,error:t.error||"Failed to get storage stats"};let{available:a}=t.data,o=r-e;if(o>a)return{success:!1,error:"Not enough storage space. Additional needed: ".concat(o," bytes, Available: ").concat(a," bytes")}}}else{let e=C(t);if(!e.success)return e}return localStorage.setItem(a,JSON.stringify(t)),{success:!0}}catch(t){if(t instanceof DOMException&&("QuotaExceededError"===t.name||"NS_ERROR_DOM_QUOTA_REACHED"===t.name))return{success:!1,error:"LocalStorage quota exceeded. Try removing some items before adding new ones."};return{success:!1,error:"Error storing data for key ".concat(e,": ").concat(t instanceof Error?t.message:String(t))}}},O=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:N;if(!T())return{success:!1,error:"LocalStorage is not available in this environment"};try{return localStorage.removeItem(R(e,t)),{success:!0}}catch(t){return{success:!1,error:"Error removing data for key ".concat(e,": ").concat(t instanceof Error?t.message:String(t))}}},v=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N;if(console.log("storageUtils: getStorageKeys for namespace '".concat(e,"'")),!T())return console.error("storageUtils: localStorage is not available"),{success:!1,error:"LocalStorage is not available in this environment"};try{let t=[],r="".concat("lab",":").concat(e,":");console.log("storageUtils: looking for keys with prefix '".concat(r,"'")),console.log("storageUtils: all keys in localStorage:");for(let e=0;e<localStorage.length;e++){let t=localStorage.key(e);console.log("  - ".concat(t))}for(let e=0;e<localStorage.length;e++){let a=localStorage.key(e);if(a&&a.startsWith(r)){let e=a.substring(r.length);t.push(e)}}return console.log("storageUtils: found ".concat(t.length," keys for namespace '").concat(e,"':"),t),{success:!0,data:t}}catch(e){return console.error("storageUtils: error in getStorageKeys",e),{success:!1,error:"Error getting storage keys: ".concat(e instanceof Error?e.message:String(e))}}};var w=r(32113),P=r(88437),U=r(33628);let H=e=>e&&e.household&&Object.keys(e.household).length>0?"complete":"draft";var Y=r(97869),F=r(14121);(a=c||(c={})).ELECTRICITY="ELECTRICITY",a.GAS="GAS",a.WATER="WATER",a.SEWAGE="SEWAGE",a.INTERNET="INTERNET",a.MOBILE="MOBILE",a.LANDLINE="LANDLINE",a.TV="TV",a.STREAMING="STREAMING",a.TRASH="TRASH",a.RECYCLING="RECYCLING",a.OTHER="OTHER",(o=i||(i={})).FIXED="FIXED",o.VARIABLE="VARIABLE",o.PREPAID="PREPAID",o.PAY_AS_YOU_GO="PAY_AS_YOU_GO",(n=l||(l={})).DINING="DINING",n.ENTERTAINMENT="ENTERTAINMENT",n.SHOPPING="SHOPPING",n.FITNESS="FITNESS",n.HOBBIES="HOBBIES",n.TRAVEL="TRAVEL",n.PERSONAL_CARE="PERSONAL_CARE",n.PETS="PETS",n.GIFTS="GIFTS",n.SUBSCRIPTIONS="SUBSCRIPTIONS",n.OTHER="OTHER",(s=u||(u={})).DAILY="DAILY",s.WEEKLY="WEEKLY",s.MONTHLY="MONTHLY",s.QUARTERLY="QUARTERLY",s.ANNUALLY="ANNUALLY",s.OCCASIONAL="OCCASIONAL";let x={id:"default-household",members:[],originCountry:Y.Cv.GB,destinationCountry:Y.Cv.PT,residencyStatus:Y.DL.PERMANENT_RESIDENT,taxRegime:Y.LT.STANDARD,size:1,dependents:0,createdAt:new Date,updatedAt:new Date},b={[Y.NE.EUR]:{baseCurrency:Y.NE.EUR,displayCurrency:Y.NE.EUR,manualRates:!1,customRates:{},sensitivityRange:[-.05,.05]},[Y.NE.USD]:{baseCurrency:Y.NE.USD,displayCurrency:Y.NE.USD,manualRates:!1,customRates:{},sensitivityRange:[-.05,.05]},[Y.NE.GBP]:{baseCurrency:Y.NE.GBP,displayCurrency:Y.NE.GBP,manualRates:!1,customRates:{},sensitivityRange:[-.05,.05]}},M={line1:"",city:"",country:Y.Cv.US,postalCode:""},_=[{id:(0,m.Z)(),name:"Primary Job",type:F.Rp.EMPLOYMENT,partner:"partner1",amount:{amount:5e4,currency:Y.NE.USD},frequency:Y.oF.ANNUALLY,isActive:!0,startDate:new Date,taxable:!0,description:"Main employment income",createdAt:new Date,updatedAt:new Date}],G={id:(0,m.Z)(),type:w.Rj.RENT,address:{...M,country:Y.Cv.PT},mainCost:{amount:1500,currency:Y.NE.EUR,frequency:Y.oF.MONTHLY},furnished:!1,bedrooms:2,bathrooms:1,createdAt:new Date,updatedAt:new Date},B={id:(0,m.Z)(),type:w.Rj.OWN,address:{...M,country:Y.Cv.PT},mainCost:{amount:1077,currency:Y.NE.EUR,frequency:Y.oF.MONTHLY},propertyTax:{amount:3e3,currency:Y.NE.EUR,frequency:Y.oF.ANNUALLY},furnished:!0,bedrooms:3,bathrooms:2,createdAt:new Date,updatedAt:new Date},k={[w.Rj.RENT]:G,[w.Rj.OWN]:B,[w.Rj.TEMPORARY]:{id:(0,m.Z)(),type:w.Rj.TEMPORARY,address:{...M,country:Y.Cv.PT},mainCost:{amount:100,currency:Y.NE.EUR,frequency:Y.oF.ONCE},furnished:!0,bedrooms:1,bathrooms:1,createdAt:new Date,updatedAt:new Date}},V={id:(0,m.Z)(),type:P.F.PRIVATE_CAR,vehicle:{make:"Toyota",model:"Camry",year:2022,isElectric:!1},mainCost:{amount:0,currency:Y.NE.USD,frequency:Y.oF.MONTHLY},fuel:{amount:150,currency:Y.NE.USD,frequency:Y.oF.MONTHLY},insurance:{id:(0,m.Z)(),provider:"Default Insurance",cost:{amount:100,currency:Y.NE.USD,frequency:Y.oF.MONTHLY},coverage:{amount:5e4,currency:Y.NE.USD},startDate:new Date,isComprehensive:!0},maintenance:{amount:50,currency:Y.NE.USD,frequency:Y.oF.MONTHLY},isCommute:!0,createdAt:new Date,updatedAt:new Date},W={id:(0,m.Z)(),type:P.F.PUBLIC,mainCost:{amount:80,currency:Y.NE.USD,frequency:Y.oF.MONTHLY},passType:P.G.MONTHLY,zones:["All"],isCommute:!0,createdAt:new Date,updatedAt:new Date},Z={[P.F.PRIVATE_CAR]:V,[P.F.PUBLIC]:W,[P.F.LEASED_CAR]:{...V,type:P.F.LEASED_CAR,mainCost:{amount:300,currency:Y.NE.USD,frequency:Y.oF.MONTHLY}},[P.F.TAXI]:{id:(0,m.Z)(),type:P.F.TAXI,mainCost:{amount:50,currency:Y.NE.USD,frequency:Y.oF.MONTHLY},isCommute:!1,createdAt:new Date,updatedAt:new Date},[P.F.RIDESHARE]:{id:(0,m.Z)(),type:P.F.RIDESHARE,mainCost:{amount:60,currency:Y.NE.USD,frequency:Y.oF.MONTHLY},isCommute:!1,createdAt:new Date,updatedAt:new Date},[P.F.BICYCLE]:{id:(0,m.Z)(),type:P.F.BICYCLE,mainCost:{amount:0,currency:Y.NE.USD,frequency:Y.oF.MONTHLY},isCommute:!0,createdAt:new Date,updatedAt:new Date},[P.F.WALKING]:{id:(0,m.Z)(),type:P.F.WALKING,mainCost:{amount:0,currency:Y.NE.USD,frequency:Y.oF.MONTHLY},isCommute:!0,createdAt:new Date,updatedAt:new Date},[P.F.OTHER]:{id:(0,m.Z)(),type:P.F.OTHER,mainCost:{amount:0,currency:Y.NE.USD,frequency:Y.oF.MONTHLY},isCommute:!1,createdAt:new Date,updatedAt:new Date}},j={[c.ELECTRICITY]:{id:(0,m.Z)(),type:c.ELECTRICITY,provider:"Default Electric Co.",planType:i.FIXED,baseCost:{amount:100,currency:Y.NE.USD,frequency:Y.oF.MONTHLY},included:!1,notes:"Based on average usage",createdAt:new Date,updatedAt:new Date},[c.INTERNET]:{id:(0,m.Z)(),type:c.INTERNET,provider:"Default ISP",planType:i.FIXED,baseCost:{amount:60,currency:Y.NE.USD,frequency:Y.oF.MONTHLY},included:!1,createdAt:new Date,updatedAt:new Date}},q=[{id:(0,m.Z)(),category:l.DINING,description:"Dining Out",amount:{amount:200,currency:Y.NE.USD,frequency:Y.oF.MONTHLY},priority:"optional",shared:!0,notes:"Restaurants and takeaways",createdAt:new Date,updatedAt:new Date},{id:(0,m.Z)(),category:l.SHOPPING,description:"Groceries",amount:{amount:400,currency:Y.NE.USD,frequency:Y.oF.MONTHLY},priority:"essential",shared:!0,notes:"Weekly grocery shopping",createdAt:new Date,updatedAt:new Date}],K={id:(0,m.Z)(),targetMonths:3,currentBalance:{amount:5e3,currency:Y.NE.USD},monthlyContribution:{amount:200,currency:Y.NE.USD},minimumBalance:{amount:1e3,currency:Y.NE.USD},location:"Savings Account",isLiquid:!0,notes:"Emergency savings fund",createdAt:new Date,updatedAt:new Date},J="scenarios",X=e=>{let{id:t,name:r,description:a,content:o,createdAt:n,updatedAt:s}=e;return{id:t,name:r,description:a,createdAt:n.toISOString(),updatedAt:s.toISOString(),content:o,schemaVersion:y.O}},Q=e=>{let{id:t,name:r,description:a,content:o,createdAt:n,updatedAt:s}=e;return{id:t,name:r,description:a,content:o,createdAt:new Date(n),updatedAt:new Date(s)}},z=(e,t)=>"".concat(e," to ").concat(t," - ").concat(new Date().toLocaleDateString()),$=e=>{try{let t=new Date,r={...e.content,schemaVersion:y.O,completionStatus:"draft"};r.completionStatus=H(r);let a={id:(0,m.Z)(),name:e.name,description:e.description,content:r,createdAt:t,updatedAt:t},o=X(a),n=D(a.id,o,J);if(!n.success)return{success:!1,error:n.error};return{success:!0,data:a}}catch(e){return{success:!1,error:"Error creating scenario: ".concat(e instanceof Error?e.message:String(e))}}},ee=e=>{try{let t=I(e,J);if(!t.success||!t.data)return{success:!1,error:t.error||"Scenario with ID ".concat(e," not found")};let r=t.data;return r.schemaVersion,y.O,{success:!0,data:Q(r)}}catch(e){return{success:!1,error:"Error retrieving scenario: ".concat(e instanceof Error?e.message:String(e))}}},et=(e,t)=>{try{let r=ee(e);if(!r.success||!r.data)return{success:!1,error:r.error||"Scenario with ID ".concat(e," not found")};let a=r.data,o=a.content;t.content&&(o={...a.content,...t.content,schemaVersion:y.O}),o.completionStatus=H(o);let n={...a,name:void 0!==t.name?t.name:a.name,description:void 0!==t.description?t.description:a.description,content:o,updatedAt:new Date},s=X(n),c=D(e,s,J);if(!c.success)return{success:!1,error:c.error};return{success:!0,data:n}}catch(e){return{success:!1,error:"Error updating scenario: ".concat(e instanceof Error?e.message:String(e))}}},er=e=>{try{let t=O(e,J);if(!t.success)return{success:!1,error:t.error};return{success:!0}}catch(e){return{success:!1,error:"Error deleting scenario: ".concat(e instanceof Error?e.message:String(e))}}},ea=()=>{console.log("scenarioStorage: listScenarios called");try{let e=v(J);if(console.log("scenarioStorage: getStorageKeys result:",e),!e.success||!e.data)return console.error("scenarioStorage: failed to get keys",e.error),{success:!1,error:e.error||"Failed to get scenario keys"};let t={};for(let r of(console.log("scenarioStorage: found keys:",e.data),e.data)){console.log("scenarioStorage: getting scenario ".concat(r));let e=ee(r);e.success&&e.data?t[r]=e.data:console.warn("scenarioStorage: failed to get scenario ".concat(r),e.error)}return console.log("scenarioStorage: returning map with",Object.keys(t).length,"scenarios"),{success:!0,data:t}}catch(e){return console.error("scenarioStorage: error in listScenarios",e),{success:!1,error:"Error listing scenarios: ".concat(e instanceof Error?e.message:String(e))}}},eo=(e,t)=>{try{let r=ee(e);if(!r.success||!r.data)return{success:!1,error:r.error};let a=r.data,o=new Date,n={...a.content};n.completionStatus=H(n);let s={...a,id:(0,m.Z)(),name:t||"".concat(a.name," (Copy)"),content:n,createdAt:o,updatedAt:o},c=X(s),i=D(s.id,c,J);if(!i.success)return{success:!1,error:i.error};return{success:!0,data:s}}catch(e){return{success:!1,error:"Error duplicating scenario: ".concat(e instanceof Error?e.message:String(e))}}},en=()=>{try{let e=ea(),t=L();if(!e.success||!e.data)return{success:!1,error:e.error||"Failed to get scenarios"};if(!t.success||!t.data)return{success:!1,error:t.error||"Failed to get storage stats"};let r=e.data,a=t.data,o=0;for(let e in r){let t=r[e],a=X(t);o+=h(a)}return{success:!0,data:{totalScenarios:Object.keys(r).length,totalSize:o,remainingSpace:a.available,usagePercentage:o/5242880*100,estimatedCapacity:Math.floor(5242880/(o/Object.keys(r).length||1))}}}catch(e){return{success:!1,error:"Error getting scenario storage stats: ".concat(e instanceof Error?e.message:String(e))}}},es=()=>{try{let e=ea();if(!e.success||!e.data)return{success:!1,error:e.error||"Failed to get scenarios"};let t=e.data,r=Object.values(t).map(e=>X(e));return{success:!0,data:JSON.stringify(r,null,2)}}catch(e){return{success:!1,error:"Error exporting scenarios: ".concat(e instanceof Error?e.message:String(e))}}},ec=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{let r=JSON.parse(e),a=[];if(r.scenarios?a=r.scenarios:r.scenarioMap&&(a=Object.values(r.scenarioMap)),0===a.length)return{success:!1,error:"No scenarios found in the imported JSON data."};let o={},n=[],s=v(J),c=[];for(let e of(s.success&&s.data&&(c=s.data),a)){if(!e.id||!e.content){n.push("Skipping item due to missing id or content: ".concat(JSON.stringify(e)));continue}if(!t&&c.includes(e.id)){n.push("Skipping existing scenario ID (overwrite is false): ".concat(e.id));continue}let r=e.content;void 0===r.completionStatus&&(r.completionStatus="draft"),r.completionStatus=H(r);let a={...e,content:r,schemaVersion:y.O,createdAt:e.createdAt?new Date(e.createdAt).toISOString():new Date().toISOString(),updatedAt:e.updatedAt?new Date(e.updatedAt).toISOString():new Date().toISOString()},s=D(a.id,a,J);s.success?o[a.id]=Q(a):n.push("Failed to save scenario ".concat(a.id,": ").concat(s.error))}if(0===Object.keys(o).length&&n.length>0)return{success:!1,error:"Import failed. Errors: ".concat(n.join("; "))};return{success:!0,data:o,error:n.length>0?"Partial import with errors: ".concat(n.join("; ")):void 0}}catch(e){return{success:!1,error:"Error importing scenarios: ".concat(e instanceof Error?e.message:String(e))}}},ei=(e,t,r)=>{console.log("scenarioStorage: createTemplateScenario called",{name:e,originCountry:t,destinationCountry:r});try{let a=new Date,o=e||z(t,r),n={schemaVersion:y.O,originCountry:t,destinationCountry:r,household:{...x},incomeSources:[..._],housingType:w.Rj.RENT,housingExpense:{...k[w.Rj.RENT]},educationExpenses:{},healthcareType:U._.PUBLIC,healthcareExpenses:{},transportType:P.F.PUBLIC,transportExpense:{...Z[P.F.PUBLIC]},lifestyleExpenses:[...q],utilityExpenses:{...j},emergencyFund:{...K},fxSettings:b[r]||b.EUR,completionStatus:"draft"};n.completionStatus=H(n);let s={id:(0,m.Z)(),name:o,description:"Template for ".concat(r," from ").concat(t),content:n,createdAt:a,updatedAt:a},c=X(s),i=D(s.id,c,J);if(!i.success)return console.error("scenarioStorage: failed to save template scenario",i.error),{success:!1,error:i.error};return console.log("scenarioStorage: template scenario saved successfully",s.id),{success:!0,data:s}}catch(e){return console.error("scenarioStorage: error creating template scenario",e),{success:!1,error:"Error creating template scenario: ".concat(e instanceof Error?e.message:String(e))}}};var el=(e,t)=>{let r=A()(async(t,r)=>{let a=await et(t,r);a.success&&a.data?e(e=>({...e,scenarios:{...e.scenarios,[t]:a.data},error:null})):(console.error("Auto-save failed:",a.error),e(e=>({...e,error:"Auto-save failed: ".concat(a.error)})))},2e3,{maxWait:5e3});return{scenarios:{},activeScenarioId:null,isLoading:!1,error:null,storageStats:null,get activeScenario(){let e=t();if(!e)return null;let r=e.scenarios||{},a=e.activeScenarioId;return a&&r[a]||null},get scenarioList(){let e=t();if(!e||!e.scenarios)return[];return Object.values(e.scenarios||{}).map(e=>({id:e.id,name:e.name,description:e.description,createdAt:e.createdAt.toISOString(),updatedAt:e.updatedAt.toISOString(),originCountry:e.content.originCountry,destinationCountry:e.content.destinationCountry,completionStatus:e.content.completionStatus||"draft"})).sort((e,t)=>new Date(t.updatedAt).getTime()-new Date(e.updatedAt).getTime())},loadScenarios:()=>{console.log("scenarioSlice: loadScenarios called"),e(e=>({...e,isLoading:!0,error:null}));try{console.log("scenarioSlice: calling listScenariosStorage");let t=ea();if(console.log("scenarioSlice: listScenariosStorage result:",t),t.success&&t.data){console.log("scenarioSlice: setting scenarios data",Object.keys(t.data).length);let r=t.data||{};console.log("scenarioSlice: scenarios data to set:",r);try{e(e=>({...e,scenarios:r,isLoading:!1,error:null})),console.log("scenarioSlice: successfully set scenarios data");try{let t=en();t.success&&t.data&&e(e=>({...e,storageStats:t.data}))}catch(e){console.error("scenarioSlice: error while getting storage stats:",e)}}catch(t){console.error("scenarioSlice: error while setting scenarios data:",t),e(e=>({...e,isLoading:!1,error:"Error setting scenarios data: ".concat(t instanceof Error?t.message:String(t))}))}}else console.error("scenarioSlice: failed to load scenarios",t.error),e(e=>({...e,isLoading:!1,error:t.error||"Failed to load scenarios"}))}catch(t){console.error("scenarioSlice: error in loadScenarios",t),e(e=>({...e,isLoading:!1,error:"Error loading scenarios: ".concat(t instanceof Error?t.message:String(t))}))}},setActiveScenarioId:t=>{e(e=>({...e,activeScenarioId:t}))},createScenario:async t=>{e(e=>({...e,isLoading:!0,error:null}));try{console.log("Input for createScenario:",JSON.stringify(t,null,2));let r={...t},a=await $(r);if(!a.success||!a.data)return e(e=>({...e,isLoading:!1,error:a.error||"Failed to create scenario"})),null;{let t=a.data;e(e=>({...e,scenarios:{...e.scenarios,[t.id]:t},activeScenarioId:t.id,isLoading:!1}));try{let t=en();t.success&&t.data&&e(e=>({...e,storageStats:t.data}))}catch(e){console.error("Error updating storage stats:",e)}return t.id}}catch(t){return console.error("Error in createScenario:",t),e(e=>({...e,isLoading:!1,error:"Error creating scenario: ".concat(t instanceof Error?t.message:String(t))})),null}},updateScenario:async(t,r)=>{e(e=>({...e,isLoading:!0,error:null}));try{let a=await et(t,r);if(!a.success||!a.data)return e(e=>({...e,isLoading:!1,error:a.error||"Failed to update scenario ".concat(t)})),!1;e(e=>({...e,scenarios:{...e.scenarios,[t]:a.data},isLoading:!1}));try{let t=en();t.success&&t.data&&e(e=>({...e,storageStats:t.data}))}catch(e){console.error("Error updating storage stats:",e)}return!0}catch(t){return e(e=>({...e,isLoading:!1,error:"Error updating scenario: ".concat(t instanceof Error?t.message:String(t))})),!1}},deleteScenario:async t=>{e(e=>({...e,isLoading:!0,error:null}));try{let r=await er(t);if(!r.success)return e(e=>({...e,isLoading:!1,error:r.error||"Failed to delete scenario ".concat(t)})),!1;e(e=>{let{[t]:r,...a}=e.scenarios,o=e.activeScenarioId===t?null:e.activeScenarioId;return{...e,scenarios:a,activeScenarioId:o,isLoading:!1}});try{let t=en();t.success&&t.data&&e(e=>({...e,storageStats:t.data}))}catch(e){console.error("Error updating storage stats:",e)}return!0}catch(t){return e(e=>({...e,isLoading:!1,error:"Error deleting scenario: ".concat(t instanceof Error?t.message:String(t))})),!1}},duplicateScenario:async(t,r)=>{e(e=>({...e,isLoading:!0,error:null}));try{let a=await eo(t,r);if(!a.success||!a.data)return e(e=>({...e,isLoading:!1,error:a.error||"Failed to duplicate scenario ".concat(t)})),null;{let t=a.data;e(e=>({...e,scenarios:{...e.scenarios,[t.id]:t},isLoading:!1}));try{let t=en();t.success&&t.data&&e(e=>({...e,storageStats:t.data}))}catch(e){console.error("Error updating storage stats:",e)}return t.id}}catch(t){return e(e=>({...e,isLoading:!1,error:"Error duplicating scenario: ".concat(t instanceof Error?t.message:String(t))})),null}},exportScenarios:async()=>{e(e=>({...e,isLoading:!0,error:null}));try{let t=await es();if(t.success&&t.data)return e(e=>({...e,isLoading:!1})),t.data;return e(e=>({...e,isLoading:!1,error:t.error||"Failed to export scenarios"})),null}catch(t){return e(e=>({...e,isLoading:!1,error:"Error exporting scenarios: ".concat(t instanceof Error?t.message:String(t))})),null}},importScenarios:async function(t){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e(e=>({...e,isLoading:!0,error:null}));try{let a=await ec(t,r);if(!a.success||!a.data)return e(e=>({...e,isLoading:!1,error:a.error||"Failed to import scenarios"})),!1;e(e=>({...e,scenarios:{...e.scenarios,...a.data},isLoading:!1}));try{let t=en();t.success&&t.data&&e(e=>({...e,storageStats:t.data}))}catch(e){console.error("Error updating storage stats:",e)}return!0}catch(t){return e(e=>({...e,isLoading:!1,error:"Error importing scenarios: ".concat(t instanceof Error?t.message:String(t))})),!1}},createTemplateScenario:async(t,r,a)=>{e(e=>({...e,isLoading:!0,error:null}));try{let o=t||z(r,a),n=await ei(o,r,a);if(!n.success||!n.data)return e(e=>({...e,isLoading:!1,error:n.error||"Failed to create template scenario"})),null;{let t=n.data;e(e=>({...e,scenarios:{...e.scenarios,[t.id]:t},activeScenarioId:t.id,isLoading:!1}));try{let t=en();t.success&&t.data&&e(e=>({...e,storageStats:t.data}))}catch(e){console.error("Error updating storage stats:",e)}return t.id}}catch(t){return e(e=>({...e,isLoading:!1,error:"Error creating template scenario: ".concat(t instanceof Error?t.message:String(t))})),null}},refreshStorageStats:()=>{try{if(!t()){console.warn("Cannot refresh storage stats: store not fully initialized");return}let r=en();r.success&&r.data?e(e=>({...e,storageStats:r.data})):console.warn("Failed to get storage stats:",r.error)}catch(e){console.error("Error refreshing storage stats:",e)}},scheduleAutoSave:(e,t)=>{r(e,t)},fromActiveScenario:e=>{var r;let a=t().activeScenario;return null==a?void 0:null===(r=a.content)||void 0===r?void 0:r[e]}}};let eu=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Y.NE.USD;try{let t=await fetch("/api/fx/latest?base=".concat(e));if(!t.ok){let e=await t.json();throw Error("Exchange rates API error: ".concat(e.error||t.statusText))}return await t.json()}catch(e){throw console.error("Error fetching latest exchange rates:",e),e}},ed={baseCurrency:Y.NE.USD,displayCurrency:Y.NE.USD,manualRates:!1,customRates:{},sensitivityRange:[-.1,.1]},eE=(e,t)=>{let r={settings:ed,rates:{},isLoading:!1,error:null,lastUpdated:null,loadInitialFXData:async()=>{e(e=>({...e,fx:{...e.fx,isLoading:!0,error:null}}));try{var r;let a=(null===(r=t().fx.settings)||void 0===r?void 0:r.baseCurrency)||Y.NE.USD,o=await eu(a);if(o&&o.rates)e(e=>({...e,fx:{...e.fx,rates:o.rates,isLoading:!1,lastUpdated:new Date(1e3*o.timestamp),error:null}}));else throw Error("Invalid API response structure for FX rates")}catch(r){console.error("Error in loadInitialFXData:",r);let t=r instanceof Error?r.message:"Failed to load exchange rates";e(e=>({...e,fx:{...e.fx,isLoading:!1,error:Error(t),rates:{}}}))}},updateFXSettings:r=>{e(e=>({...e,fx:{...e.fx,settings:{...t().fx.settings||ed,...r}}}))},addExchangeRate:r=>{var a;console.log("[fxSlice.ts] addExchangeRate called (Original Implementation) with:",r);let o=(null===(a=t().fx.settings)||void 0===a?void 0:a.baseCurrency)||Y.NE.USD,n=null,s=null;if(r.fromCurrency===o)n=r.toCurrency,s=r.rate;else if(r.toCurrency===o){if(n=r.fromCurrency,0===r.rate){console.error("[fxSlice.ts] addExchangeRate: Cannot add exchange rate with a zero inverse rate.");return}s=1/r.rate}else{console.warn("[fxSlice.ts] addExchangeRate: Rate ".concat(r.fromCurrency,"-").concat(r.toCurrency," is not against the base currency ").concat(o,". Ignoring."));return}n&&null!==s?e(e=>({...e,fx:{...e.fx,rates:{...e.fx.rates||{},[n]:s},lastUpdated:new Date}})):console.warn("[fxSlice.ts] addExchangeRate: targetCurrencyCode or rateToBase was null. No update performed.")},updateExchangeRate:(t,r)=>{console.log("[fxSlice.ts] updateExchangeRate called (Original Implementation) for:",t,"with rate:",r),"number"==typeof r.rate?e(e=>e.fx.rates&&e.fx.rates.hasOwnProperty(t)?{...e,fx:{...e.fx,rates:{...e.fx.rates,[t]:r.rate},lastUpdated:new Date}}:(console.warn("[fxSlice.ts] updateExchangeRate: Currency code ".concat(t," not found in rates. No update performed.")),e)):console.warn("[fxSlice.ts] updateExchangeRate: newRateUpdate did not contain a valid rate property.")},getExchangeRate:(e,r)=>{console.log("[fxSlice.ts] getExchangeRate called (Original Implementation).");let{rates:a,settings:o,lastUpdated:n}=t().fx,s=(null==o?void 0:o.baseCurrency)||Y.NE.USD;if(e===r)return{id:"".concat(e,"-").concat(r,"-self"),fromCurrency:e,toCurrency:r,rate:1,provider:"system",createdAt:new Date,updatedAt:new Date};if(o&&o.manualRates&&o.customRates&&"object"==typeof o.customRates){let t="".concat(e,"-").concat(r);if(o.customRates.hasOwnProperty(t))return{id:"custom-".concat(t),fromCurrency:e,toCurrency:r,rate:o.customRates[t],provider:"manual",createdAt:new Date,updatedAt:new Date};let a="".concat(r,"-").concat(e);if(o.customRates.hasOwnProperty(a)){let t=o.customRates[a];if(0!==t)return{id:"custom-inverse-".concat(a),fromCurrency:e,toCurrency:r,rate:1/t,provider:"manual-inverse",createdAt:new Date,updatedAt:new Date}}}if(!a||"object"!=typeof a)return console.warn("[fxSlice.ts] getExchangeRate: Rates not available or not an object."),null;let c=null;return(e===s?a.hasOwnProperty(r)&&(c=a[r]):r===s?a.hasOwnProperty(e)&&0!==a[e]&&(c=1/a[e]):a.hasOwnProperty(r)&&a.hasOwnProperty(e)&&0!==a[e]&&(c=a[r]/a[e]),null===c||isNaN(c))?(console.warn("[fxSlice.ts] getExchangeRate: Could not determine rate for ".concat(e," to ").concat(r)),null):{id:"".concat(e,"-").concat(r,"-api"),fromCurrency:e,toCurrency:r,rate:c,provider:"api",createdAt:n||new Date,updatedAt:n||new Date}},convertAmount:(e,r,a)=>{console.log("[fxSlice.ts] convertAmount called (Original Implementation).");let o=t().fx.getExchangeRate(r,a);return o&&"number"==typeof o.rate?e*o.rate:null}};return console.log("[fxSlice.ts] Restored fxSliceObject defined. Keys:",Object.keys(r)),r},eg=e=>({ui:{activeView:"home",sidebarOpen:!0,theme:"light",setActiveView:t=>{e(e=>({ui:{...e.ui,activeView:t}}))},toggleSidebar:()=>{e(e=>({ui:{...e.ui,sidebarOpen:!e.ui.sidebarOpen}}))},setTheme:t=>{if(e(e=>({ui:{...e.ui,theme:t}})),"undefined"!=typeof document){let e=document.documentElement;if("system"===t){let t=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";e.setAttribute("data-theme",t)}else e.setAttribute("data-theme",t)}}}});var em=(e,t)=>{let r=(e,t)=>{let r=e.amount;switch(t){case Y.LT.PORTUGAL_NHR:r=.8*e.amount;break;case Y.LT.STANDARD:r=e.amount<=2e3?.9*e.amount:e.amount<=4e3?.8*e.amount:.7*e.amount;break;default:r=.8*e.amount}return{amount:r,currency:e.currency}},a=()=>{let a=t(),o=a.income.tempIncomes,n=a.income.taxRegime,s={};o.forEach(e=>{if(e.isActive){let t=(0,F.Jp)(e.amount.amount,e.frequency),r=e.amount.currency;s[r]||(s[r]=0),s[r]+=t}});let c=Y.NE.EUR,i={amount:s[c]||0,currency:c},l=r(i,n);e(e=>({...e,income:{...e.income,totalGrossIncome:i,totalNetIncome:l}}))};return{tempIncomes:[],taxRegime:Y.LT.STANDARD,totalGrossIncome:{amount:0,currency:Y.NE.EUR},totalNetIncome:{amount:0,currency:Y.NE.EUR},addIncome:t=>{let r={...t,id:(0,m.Z)(),createdAt:new Date,updatedAt:new Date};e(e=>{let t=[...e.income.tempIncomes,r];return{...e,income:{...e.income,tempIncomes:t}}}),a()},updateIncome:(t,r)=>{e(e=>{let a=e.income.tempIncomes.map(e=>e.id===t?{...e,...r,updatedAt:new Date}:e);return{...e,income:{...e.income,tempIncomes:a}}}),a()},deleteIncome:t=>{e(e=>({...e,income:{...e.income,tempIncomes:e.income.tempIncomes.filter(e=>e.id!==t)}})),a()},setTaxRegime:t=>{e(e=>({...e,income:{...e.income,taxRegime:t}})),a()},loadIncomesFromScenario:(t,r)=>{e(e=>({...e,income:{...e.income,tempIncomes:t,taxRegime:r||e.income.taxRegime}})),a()},clearIncomes:()=>{e(e=>({...e,income:{...e.income,tempIncomes:[],totalGrossIncome:{amount:0,currency:Y.NE.EUR},totalNetIncome:{amount:0,currency:Y.NE.EUR}}}))},calculateTotals:a,calculateNetIncome:r,getIncomesByPartner:e=>t().income.tempIncomes.filter(t=>t.partner===e)}};let eS=(0,d.Ue)()((0,E.mW)((0,E.tJ)((e,t,r)=>{let a=p(e,t,r),o=el(e,t,r),n=eE(e,t,r),s=eg(e,t,r),c=em(e,t,r);return{profile:a,scenarios:o.scenarios,activeScenarioId:o.activeScenarioId,isLoading:o.isLoading,error:o.error,storageStats:o.storageStats,activeScenario:o.activeScenario,scenarioList:o.scenarioList,loadScenarios:o.loadScenarios,setActiveScenarioId:o.setActiveScenarioId,createScenario:o.createScenario,updateScenario:o.updateScenario,deleteScenario:o.deleteScenario,duplicateScenario:o.duplicateScenario,exportScenarios:o.exportScenarios,importScenarios:o.importScenarios,createTemplateScenario:o.createTemplateScenario,refreshStorageStats:o.refreshStorageStats,scheduleAutoSave:o.scheduleAutoSave,fromActiveScenario:o.fromActiveScenario,fx:n,income:c,ui:s.ui}},{name:"living-abroad-budget-store",onRehydrateStorage:()=>(e,t)=>{t?console.error("[store] Hydration error:",t):setTimeout(()=>{var t;(null==e?void 0:null===(t=e.profile)||void 0===t?void 0:t.setHydrated)&&e.profile.setHydrated()},0)}}),{name:"living-abroad-budget-devtools"}))},97869:function(e,t,r){var a,o,n,s,c,i,l,u,d,E;r.d(t,{Cv:function(){return a},DL:function(){return s},LT:function(){return c},NE:function(){return o},oF:function(){return n}}),(i=a||(a={})).GB="GB",i.PT="PT",i.US="US",i.ES="ES",i.FR="FR",i.IT="IT",i.DE="DE",i.CA="CA",i.AU="AU",i.NZ="NZ",i.IE="IE",i.CH="CH",i.GR="GR",i.AT="AT",i.BE="BE",i.NL="NL",i.SE="SE",i.NO="NO",i.DK="DK",i.FI="FI",i.JP="JP",i.CN="CN",i.SG="SG",i.AE="AE",i.BR="BR",i.MX="MX",(l=o||(o={})).GBP="GBP",l.EUR="EUR",l.USD="USD",l.JPY="JPY",l.CAD="CAD",l.AUD="AUD",(u=n||(n={})).ONCE="ONCE",u.WEEKLY="WEEKLY",u.BIWEEKLY="BIWEEKLY",u.MONTHLY="MONTHLY",u.QUARTERLY="QUARTERLY",u.ANNUALLY="ANNUALLY",(d=s||(s={})).CITIZEN="CITIZEN",d.PERMANENT_RESIDENT="PERMANENT_RESIDENT",d.TEMPORARY_RESIDENT="TEMPORARY_RESIDENT",d.NON_RESIDENT="NON_RESIDENT",(E=c||(c={})).STANDARD="STANDARD",E.PORTUGAL_NHR="PORTUGAL_NHR"},33628:function(e,t,r){var a,o,n,s;r.d(t,{_:function(){return a}}),(n=a||(a={})).PUBLIC="PUBLIC",n.PRIVATE="PRIVATE",n.HYBRID="HYBRID",n.TRAVEL="TRAVEL",(s=o||(o={})).GENERAL_PRACTICE="GENERAL_PRACTICE",s.SPECIALIST="SPECIALIST",s.DENTAL="DENTAL",s.VISION="VISION",s.MENTAL_HEALTH="MENTAL_HEALTH",s.PRESCRIPTION="PRESCRIPTION",s.EMERGENCY="EMERGENCY",s.HOSPITALIZATION="HOSPITALIZATION",s.PREVENTIVE="PREVENTIVE",s.ALTERNATIVE="ALTERNATIVE"},85270:function(e,t,r){var a,o;r.d(t,{S9:function(){return a}}),(o=a||(a={})).PRIMARY="PRIMARY",o.SPOUSE="SPOUSE",o.CHILD="CHILD",o.OTHER="OTHER"},32113:function(e,t,r){var a,o,n,s,c,i;r.d(t,{Rj:function(){return a}}),(s=a||(a={})).RENT="RENT",s.OWN="OWN",s.TEMPORARY="TEMPORARY",(c=o||(o={})).RENTERS="RENTERS",c.HOMEOWNERS="HOMEOWNERS",c.CONTENTS="CONTENTS",c.LIABILITY="LIABILITY",(i=n||(n={})).ELECTRICITY="ELECTRICITY",i.GAS="GAS",i.WATER="WATER",i.INTERNET="INTERNET",i.TV="TV",i.PHONE="PHONE",i.TRASH="TRASH",i.OTHER="OTHER"},14121:function(e,t,r){r.d(t,{Jp:function(){return u},Rp:function(){return s},oF:function(){return l.oF}});var a,o,n,s,c,i,l=r(97869);function u(e,t){switch(t){case l.oF.WEEKLY:return 52*e/12;case l.oF.BIWEEKLY:return 26*e/12;case l.oF.MONTHLY:return e;case l.oF.QUARTERLY:return e/3;case l.oF.ANNUALLY:case l.oF.ONCE:return e/12;default:throw Error("Unsupported frequency: ".concat(t))}}(a=s||(s={})).EMPLOYMENT="EMPLOYMENT",a.PASSIVE="PASSIVE",a.ONE_OFF="ONE_OFF",a.OTHER="OTHER",(o=c||(c={})).FULL_TIME="FULL_TIME",o.PART_TIME="PART_TIME",o.CONTRACT="CONTRACT",o.FREELANCE="FREELANCE",(n=i||(i={})).RENTAL="RENTAL",n.DIVIDEND="DIVIDEND",n.INTEREST="INTEREST",n.ROYALTY="ROYALTY",n.OTHER="OTHER"},97354:function(e,t,r){r.d(t,{O:function(){return a}});let a=1},88437:function(e,t,r){var a,o,n,s;r.d(t,{F:function(){return a},G:function(){return o}}),(n=a||(a={})).PUBLIC="PUBLIC",n.PRIVATE_CAR="PRIVATE_CAR",n.LEASED_CAR="LEASED_CAR",n.TAXI="TAXI",n.RIDESHARE="RIDESHARE",n.BICYCLE="BICYCLE",n.WALKING="WALKING",n.OTHER="OTHER",(s=o||(o={})).SINGLE="SINGLE",s.DAILY="DAILY",s.WEEKLY="WEEKLY",s.MONTHLY="MONTHLY",s.ANNUAL="ANNUAL",s.PAY_AS_YOU_GO="PAY_AS_YOU_GO"}}]);